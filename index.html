<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Holy Moment - ì¼ì¼ ì„±ê²½ ë§ì”€ ë¬µìƒ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700&family=Pretendard:wght@300;400;600&display=swap"
        rel="stylesheet">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#6d5d6e">
    <link rel="apple-touch-icon" href="holy_moment_app_icon.png">
    <style>
        :root {
            --bg-color: #f8f9fa;
            --accent-color: #6d5d6e;
            --text-main: #343a40;
            --text-sub: #6c757d;
            --glass-bg: rgba(255, 255, 255, 0.75);
            --glass-border: rgba(255, 255, 255, 0.4);
            --shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Pretendard', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%),
                url('https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?auto=format&fit=crop&q=80&w=1920') center/cover no-repeat;
            background-blend-mode: overlay;
            min-height: 100vh;
            color: var(--text-main);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 600px;
            background: var(--glass-bg);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-radius: 30px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow);
            padding: 40px;
            animation: fadeIn 1.2s ease-out;
            position: relative;
        }

        /* ì„¤ì • ì•„ì´ì½˜ */
        .settings-trigger {
            position: absolute;
            top: 25px;
            right: 25px;
            font-size: 1.4rem;
            cursor: pointer;
            color: var(--accent-color);
            transition: transform 0.3s ease;
            z-index: 10;
        }

        .settings-trigger:hover {
            transform: rotate(45deg);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        header {
            text-align: center;
            margin-bottom: 40px;
        }

        .logo {
            font-family: 'Noto Serif KR', serif;
            font-size: 1.4rem;
            color: var(--accent-color);
            letter-spacing: 3px;
            text-transform: uppercase;
            margin-bottom: 8px;
            display: block;
            font-weight: 700;
        }

        .current-time {
            font-size: 0.95rem;
            color: var(--text-sub);
            letter-spacing: 0.5px;
        }

        .verse-section {
            margin-bottom: 30px;
            text-align: center;
        }

        .verse-text {
            font-family: 'Noto Serif KR', serif;
            font-size: 1.7rem;
            line-height: 1.7;
            margin-bottom: 24px;
            color: #1a202c;
            word-break: keep-all;
            padding: 0 10px;
        }

        .verse-ref {
            font-size: 1.1rem;
            color: var(--accent-color);
            font-weight: 600;
            opacity: 0.9;
        }

        /* ê³ ë„í™” ë„êµ¬ ëª¨ìŒ */
        .tool-bar {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 25px 0;
        }

        .tool-btn {
            background: white;
            border: 1px solid rgba(0, 0, 0, 0.08);
            width: 45px;
            height: 45px;
            border-radius: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1.2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .tool-btn:hover {
            transform: translateY(-2px);
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .tool-btn:active {
            transform: translateY(0);
        }

        .interpretation-box {
            background: rgba(255, 255, 255, 0.4);
            padding: 28px;
            border-radius: 20px;
            margin-top: 10px;
            font-size: 1.05rem;
            line-height: 1.9;
            color: #2d3748;
            text-align: left;
            border-left: 5px solid var(--accent-color);
        }

        .interpretation-title {
            font-weight: 700;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--accent-color);
            font-size: 1.1rem;
        }

        .reflection-section {
            border-top: 1px solid rgba(0, 0, 0, 0.08);
            padding-top: 35px;
            margin-top: 35px;
        }

        .reflection-label {
            font-weight: 700;
            margin-bottom: 18px;
            display: block;
            color: var(--text-main);
            font-size: 1.1rem;
        }

        textarea {
            width: 100%;
            height: 120px;
            border-radius: 18px;
            border: 1px solid rgba(0, 0, 0, 0.12);
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            font-family: inherit;
            font-size: 1.05rem;
            line-height: 1.6;
            resize: none;
            outline: none;
            transition: all 0.3s;
        }

        textarea:focus {
            border-color: var(--accent-color);
            background: #fff;
            box-shadow: 0 0 0 4px rgba(109, 93, 110, 0.1);
        }

        .save-btn {
            width: 100%;
            padding: 18px;
            margin-top: 20px;
            border: none;
            border-radius: 18px;
            background: var(--accent-color);
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .save-btn:hover {
            background: #5a4d5a;
            transform: translateY(-2px);
        }

        .history-btn {
            background: none;
            border: none;
            color: var(--text-sub);
            font-size: 0.95rem;
            margin-top: 25px;
            cursor: pointer;
            width: 100%;
            text-align: center;
            opacity: 0.8;
        }

        /* ê³µí†µ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(8px);
        }

        .modal-content {
            background: white;
            width: 90%;
            max-width: 550px;
            max-height: 85vh;
            border-radius: 30px;
            padding: 40px;
            overflow-y: auto;
            position: relative;
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 25px;
            cursor: pointer;
            font-size: 2rem;
            color: #aaa;
        }

        /* ì•ŒëŒ ì„¤ì • íŠ¹ì • ìŠ¤íƒ€ì¼ */
        .alarm-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .hour-chip {
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .hour-chip.active {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .alarm-toggle-group {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-bottom: 15px;
        }

        .small-btn {
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #ddd;
            background: #f9f9f9;
            font-size: 0.8rem;
            cursor: pointer;
        }

        @media (max-width: 480px) {
            .container {
                padding: 30px 20px;
            }

            .verse-text {
                font-size: 1.4rem;
            }

            .alarm-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>

<body>

    <div class="container">
        <!-- ì„¤ì • ì•„ì´ì½˜ -->
        <div id="openSettings" class="settings-trigger" title="ì•ŒëŒ ì„¤ì •">âš™ï¸</div>

        <header>
            <span class="logo">Holy Moment</span>
            <div id="dateDisplay" class="current-time"></div>
        </header>

        <main>
            <section class="verse-section">
                <p id="verseText" class="verse-text">ë§ì”€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
                <p id="verseRef" class="verse-ref"></p>

                <!-- ê¸°ëŠ¥ ë²„íŠ¼ ë ˆì´ì–´ -->
                <div class="tool-bar">
                    <button id="ttsBtn" class="tool-btn" title="ë§ì”€ ì½ê¸°">ğŸ”Š</button>
                    <button id="shareBtn" class="tool-btn" title="ì¹´í†¡/ì§€ì¸ ê³µìœ ">ğŸ”—</button>
                    <button id="copyBtn" class="tool-btn" title="ë³µì‚¬í•˜ê¸°">ğŸ“„</button>
                </div>

                <div class="interpretation-box">
                    <span class="interpretation-title">ğŸ“œ ì˜¤ëŠ˜ì˜ ë¬µìƒ ê°€ì´ë“œ</span>
                    <p id="interpretationText">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.</p>
                </div>
            </section>

            <section class="reflection-section">
                <label class="reflection-label">ğŸ’­ ë‚˜ì˜ ë¬µìƒ ê¸°ë¡í•˜ê¸°</label>
                <textarea id="reflectionInput" placeholder="ì´ ë§ì”€ì„ í†µí•´ ëŠë‚€ ì ì´ë‚˜ ê¸°ë„ë¥¼ ì ì–´ë³´ì„¸ìš”..."></textarea>
                <button id="saveBtn" class="save-btn">ë¬µìƒ ì €ì¥í•˜ê¸°</button>
                <button id="showHistory" class="history-btn">ì§€ë‚œ ê¸°ë¡ ë³´ê¸°</button>
            </section>
        </main>
    </div>

    <!-- ì•ŒëŒ ì„¤ì • ëª¨ë‹¬ -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="closeSettings">&times;</span>
            <h2 style="margin-bottom: 20px; font-family: 'Noto Serif KR', serif; color: var(--accent-color);">ì•ŒëŒ ì‹œìŠ¤í…œ ì„¤ì •
            </h2>
            <p style="font-size: 0.95rem; color: #666; margin-bottom: 20px; line-height: 1.6;">
                ë§¤ ì‹œê°„ ì •ê°ì— ë§ì”€ì„ ë°›ì•„ë³´ì‹¤ ì‹œê°„ëŒ€ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”. <br>
                <span style="color: var(--accent-color); font-weight: 600;">* ë¸Œë¼ìš°ì € ì•Œë¦¼ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.</span>
            </p>

            <div class="alarm-toggle-group">
                <button class="small-btn" onclick="toggleAllAlarms(true)">ì „ì²´ ì„ íƒ</button>
                <button class="small-btn" onclick="toggleAllAlarms(false)">ì „ì²´ í•´ì œ</button>
            </div>

            <div id="alarmGrid" class="alarm-grid">
                <!-- 0ì‹œë¶€í„° 23ì‹œê¹Œì§€ ë™ì  ìƒì„± -->
            </div>

            <button id="saveSettings" class="save-btn" style="background: #2d3748;">ì„¤ì • ì™„ë£Œ</button>
        </div>
    </div>

    <!-- ê¸°ì¡´ ê¸°ë¡ ëª¨ë‹¬ -->
    <div id="historyModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="closeHistory">&times;</span>
            <h2 style="margin-bottom: 25px; font-family: 'Noto Serif KR', serif; color: var(--accent-color);">ë‚˜ì˜ ë¬µìƒ ê¸°ë¡
            </h2>
            <div id="historyList"></div>
        </div>
    </div>

    <script>
        const bibleData = [
            { verse: "ì—¬í˜¸ì™€ëŠ” ë‚˜ì˜ ëª©ìì‹œë‹ˆ ë‚´ê²Œ ë¶€ì¡±í•¨ì´ ì—†ìœ¼ë¦¬ë¡œë‹¤", ref: "ì‹œí¸ 23:1", interp: "ìš°ë¦¬ì˜ ì‚¶ì„ ì¸ë„í•˜ì‹œëŠ” í•˜ë‚˜ë‹˜ì„ ì „ì ìœ¼ë¡œ ì‹ ë¢°í•©ì‹œë‹¤. ì£¼ë‹˜ì´ ê³„ì‹œê¸°ì— ìš°ë¦¬ëŠ” ì´ë¯¸ ì¶©ë¶„í•©ë‹ˆë‹¤." },
            { verse: "ë„ˆëŠ” ë§ˆìŒì„ ë‹¤í•˜ì—¬ ì—¬í˜¸ì™€ë¥¼ ì‹ ë¢°í•˜ê³  ë„¤ ëª…ì² ì„ ì˜ì§€í•˜ì§€ ë§ë¼", ref: "ì ì–¸ 3:5", interp: "ë‚˜ì˜ í•œê³„ë¥¼ ì¸ì •í•˜ê³  ì£¼ë‹˜ì˜ ì§€í˜œë¥¼ êµ¬í•˜ëŠ” ì‹œê°„ì…ë‹ˆë‹¤. ë‚´ ìƒê°ë³´ë‹¤ í¬ì‹  ì£¼ë‹˜ì˜ ê¸¸ì„ ì‹ ë¢°í•˜ì„¸ìš”." },
            { verse: "ë‚´ê²Œ ëŠ¥ë ¥ ì£¼ì‹œëŠ” ì ì•ˆì—ì„œ ë‚´ê°€ ëª¨ë“  ê²ƒì„ í•  ìˆ˜ ìˆëŠë‹ˆë¼", ref: "ë¹Œë¦½ë³´ì„œ 4:13", interp: "ë‚˜ì˜ í˜ì´ ì•„ë‹Œ, ì£¼ë‹˜ì´ ì£¼ì‹œëŠ” í˜ìœ¼ë¡œ ì˜¤ëŠ˜ì„ ì‚´ì•„ê°‘ì‹œë‹¤. ì£¼ë‹˜ì€ ë‹¹ì‹ ì˜ ëŠ¥ë ¥ì´ ë˜ì‹­ë‹ˆë‹¤." },
            { verse: "ë‘ë ¤ì›Œí•˜ì§€ ë§ë¼ ë‚´ê°€ ë„ˆì™€ í•¨ê»˜ í•¨ì´ë¼", ref: "ì´ì‚¬ì•¼ 41:10", interp: "ê³ ë‚œ ì¤‘ì— ìˆë‚˜ìš”? ì£¼ë‹˜ì´ ë‹¹ì‹ ì˜ ì†ì„ ê¼­ ì¡ê³  ê³„ì‹­ë‹ˆë‹¤. ì£¼ë‹˜ì˜ ì„ì¬ ì•ˆì—ì„œ í‰ì•ˆì„ ëˆ„ë¦¬ì„¸ìš”." },
            { verse: "í•­ìƒ ê¸°ë»í•˜ë¼ ì‰¬ì§€ ë§ê³  ê¸°ë„í•˜ë¼ ë²”ì‚¬ì— ê°ì‚¬í•˜ë¼", ref: "ë°ì‚´ë¡œë‹ˆê°€ì „ì„œ 5:16-18", interp: "ê°ì‚¬ëŠ” ìƒí™©ì´ ì•„ë‹Œ ê²°ë‹¨ì…ë‹ˆë‹¤. ì˜¤ëŠ˜ í•œ ê°€ì§€ ê°ì‚¬ì˜ ì œëª©ì„ ì°¾ì•„ ì£¼ë‹˜ê»˜ ê³ ë°±í•´ ë´…ì‹œë‹¤." },
            { verse: "ë„ˆí¬ ì—¼ë ¤ë¥¼ ë‹¤ ì£¼ê»˜ ë§¡ê¸°ë¼ ì´ëŠ” ê·¸ê°€ ë„ˆí¬ë¥¼ ëŒë³´ì‹¬ì´ë¼", ref: "ë² ë“œë¡œì „ì„œ 5:7", interp: "ë§ˆìŒì˜ ì§ì„ ì£¼ë‹˜ ì•ì— ë‚´ë ¤ë†“ìœ¼ì„¸ìš”. ì£¼ë‹˜ì€ ë‹¹ì‹ ì˜ ì‘ì€ ì‹ ìŒ ì†Œë¦¬ì—ë„ ê·€ë¥¼ ê¸°ìš¸ì´ì‹­ë‹ˆë‹¤." },
            { verse: "ë‚´ê°€ ì„¸ìƒ ëë‚ ê¹Œì§€ ë„ˆí¬ì™€ í•­ìƒ í•¨ê»˜ ìˆìœ¼ë¦¬ë¼", ref: "ë§ˆíƒœë³µìŒ 28:20", interp: "ì™¸ë¡­ë‹¤ê³  ëŠê»´ì§ˆ ë•Œ ê¸°ì–µí•˜ì„¸ìš”. ì„¸ìƒ ê·¸ ëˆ„êµ¬ë³´ë‹¤ ë‹¹ì‹ ì„ ì˜ ì•„ì‹œëŠ” ì£¼ë‹˜ì´ ê³ì— ê³„ì‹­ë‹ˆë‹¤." },
            { verse: "ìˆ˜ê³ í•˜ê³  ë¬´ê±°ìš´ ì§ ì§„ ìë“¤ì•„ ë‹¤ ë‚´ê²Œë¡œ ì˜¤ë¼ ë‚´ê°€ ë„ˆí¬ë¥¼ ì‰¬ê²Œ í•˜ë¦¬ë¼", ref: "ë§ˆíƒœë³µìŒ 11:28", interp: "ì°¸ëœ ì•ˆì‹ì€ ì£¼ë‹˜ í’ˆ ì•ˆì— ìˆìŠµë‹ˆë‹¤. ë¶„ì£¼í•¨ì„ ë‚´ë ¤ë†“ê³  ì£¼ë‹˜ ì•ˆì—ì„œ ì‰¼ì„ ì–»ìœ¼ì„¸ìš”." },
            { verse: "í•˜ë‚˜ë‹˜ì€ ì‚¬ë‘ì´ì‹¬ì´ë¼", ref: "ìš”í•œì¼ì„œ 4:8", interp: "ë‹¹ì‹ ì€ ì¡°ê±´ ì—†ì´ ì‚¬ë‘ë°›ëŠ” ì¡´ì¬ì…ë‹ˆë‹¤. ê·¸ ì‚¬ë‘ì´ ì˜¤ëŠ˜ ë‹¹ì‹ ì„ ì‚´ê²Œ í•˜ëŠ” í˜ì´ ë˜ê¸¸ ì†Œë§í•©ë‹ˆë‹¤." },
            { verse: "ì£¼ ì—¬í˜¸ì™€ë¥¼ ì•™ë§í•˜ëŠ” ìëŠ” ìƒˆ í˜ì„ ì–»ìœ¼ë¦¬ë‹ˆ", ref: "ì´ì‚¬ì•¼ 40:31", interp: "ì§€ì¹˜ê³  ë‚™ì‹¬ë  ë•Œ ì£¼ë‹˜ì„ ë°”ë¼ë³´ì‹­ì‹œì˜¤. ì£¼ë‹˜ì´ ë¶€ì–´ì£¼ì‹œëŠ” ìƒˆ í˜ì´ ë‹¹ì‹ ì„ ì¼ìœ¼ì¼œ ì„¸ìš¸ ê²ƒì…ë‹ˆë‹¤." },
            { verse: "ì£¼ì˜ ë§ì”€ì€ ë‚´ ë°œì— ë“±ì´ìš” ë‚´ ê¸¸ì— ë¹›ì´ë‹ˆì´ë‹¤", ref: "ì‹œí¸ 119:105", interp: "ì–´ë‘ìš´ ê¸¸ì„ ê±·ê³  ìˆë‹¤ë©´ ë§ì”€ì„ ë“±ë¶ˆ ì‚¼ìœ¼ì‹­ì‹œì˜¤. ë§ì”€ì´ ë‹¹ì‹ ì˜ ê°ˆ ê¸¸ì„ í™˜íˆ ë¹„ì¶°ì¤„ ê²ƒì…ë‹ˆë‹¤." },
            { verse: "ë„¤ ê¸¸ì„ ì—¬í˜¸ì™€ê»˜ ë§¡ê¸°ë¼ ê·¸ë¥¼ ì˜ì§€í•˜ë©´ ê·¸ê°€ ì´ë£¨ì‹œê³ ", ref: "ì‹œí¸ 37:5", interp: "ë¶ˆì•ˆí•œ ë¯¸ë˜ë¥¼ ì£¼ë‹˜ê»˜ ë§¡ê²¨ ë³´ì‹­ì‹œì˜¤. ì£¼ë‹˜ì˜ ì™„ë²½í•œ íƒ€ì´ë°ì— ì£¼ë‹˜ì˜ ëœ»ì´ ì´ë£¨ì–´ì§ˆ ê²ƒì…ë‹ˆë‹¤." },
            { verse: "í‰ì•ˆì„ ë„ˆí¬ì—ê²Œ ë¼ì¹˜ë…¸ë‹ˆ ê³§ ë‚˜ì˜ í‰ì•ˆì„ ë„ˆí¬ì—ê²Œ ì£¼ë…¸ë¼", ref: "ìš”í•œë³µìŒ 14:27", interp: "ì„¸ìƒì´ ì¤„ ìˆ˜ ì—†ëŠ” í•˜ëŠ˜ì˜ í‰ì•ˆì´ ë‹¹ì‹ ì˜ ë§ˆìŒì„ ë®ê¸°ë¥¼ ê¸°ë„í•©ë‹ˆë‹¤. í­í’ ì†ì—ì„œë„ í‰ì•ˆí•˜ì„¸ìš”." },
            { verse: "êµ¬í•˜ë¼ ê·¸ë¦¬í•˜ë©´ ë„ˆí¬ì—ê²Œ ì£¼ì‹¤ ê²ƒì´ìš”", ref: "ë§ˆíƒœë³µìŒ 7:7", interp: "ì£¼ë‹˜ì€ ë‹¹ì‹ ê³¼ ëŒ€í™”í•˜ê¸°ë¥¼ ì›í•˜ì‹­ë‹ˆë‹¤. ë§ˆìŒì˜ ì†Œì›ì„ ì‹ ë¢°í•¨ìœ¼ë¡œ ì•„ë¢°ì–´ ë³´ì‹­ì‹œì˜¤." },
            { verse: "ìš°ë¦¬ê°€ ì•Œê±°ë‹ˆì™€ í•˜ë‚˜ë‹˜ì„ ì‚¬ë‘í•˜ëŠ” ì... ëª¨ë“  ê²ƒì´ í•©ë ¥í•˜ì—¬ ì„ ì„ ì´ë£¨ëŠë‹ˆë¼", ref: "ë¡œë§ˆì„œ 8:28", interp: "ì§€ê¸ˆì˜ ê³ í†µë„ ê²°êµ­ì€ ì„ í•œ ë„êµ¬ê°€ ë  ê²ƒì…ë‹ˆë‹¤. ì£¼ë‹˜ì˜ í° ê·¸ë¦¼ì„ ë¯¿ê³  ê¸°ë‹¤ë¦½ì‹œë‹¤." },
            { verse: "ë„ˆí¬ëŠ” ì„¸ìƒì˜ ë¹›ì´ë¼", ref: "ë§ˆíƒœë³µìŒ 5:14", interp: "ë‹¹ì‹ ì„ í†µí•´ ì£¼ë‹˜ì˜ ì‚¬ë‘ì´ í˜ëŸ¬ê°‘ë‹ˆë‹¤. ì˜¤ëŠ˜ ëˆ„êµ°ê°€ì—ê²Œ ì‘ì€ ë¹›ì´ ë˜ì–´ì£¼ëŠ” ê²ƒì€ ì–´ë–¨ê¹Œìš”?" },
            { verse: "ì˜¤ì§ ì—¬í˜¸ì™€ë¥¼ ê¸°ë»í•˜ëŠ” ê²ƒì´ ë„ˆí¬ì˜ í˜ì´ë‹ˆë¼", ref: "ëŠí—¤ë¯¸ì•¼ 8:10", interp: "ì§„ì •í•œ ì—ë„ˆì§€ëŠ” ì£¼ë‹˜ì„ ê¸°ë»í•¨ì—ì„œ ë‚˜ì˜µë‹ˆë‹¤. ì˜¤ëŠ˜ í•˜ë£¨ ì£¼ë‹˜ ì•ˆì—ì„œ í–‰ë³µì„ ì°¾ìœ¼ì„¸ìš”." },
            { verse: "ë¯¿ìŒì€ ë°”ë¼ëŠ” ê²ƒë“¤ì˜ ì‹¤ìƒì´ìš” ë³´ì´ì§€ ì•ŠëŠ” ê²ƒë“¤ì˜ ì¦ê±°ë‹ˆ", ref: "íˆë¸Œë¦¬ì„œ 11:1", interp: "ëˆˆì— ë³´ì´ëŠ” ìƒí™© ë„ˆë¨¸ë¥¼ ë³´ëŠ” ê²ƒì´ ë¯¿ìŒì…ë‹ˆë‹¤. ì•½ì†ì„ ì£¼ì‹  ì£¼ë‹˜ì„ ì˜ì§€í•˜ë©° ë‚˜ì•„ê°‘ì‹œë‹¤." },
            { verse: "ë§ˆìŒì´ ì²­ê²°í•œ ìëŠ” ë³µì´ ìˆë‚˜ë‹ˆ ê·¸ë“¤ì´ í•˜ë‚˜ë‹˜ì„ ë³¼ ê²ƒì„ì´ìš”", ref: "ë§ˆíƒœë³µìŒ 5:8", interp: "ë³µì¡í•œ ìƒê°ë“¤ì„ ì •ë¦¬í•˜ê³  ìˆœì „í•œ ë§ˆìŒìœ¼ë¡œ ì£¼ë‹˜ ì•ì— ì„­ì‹œë‹¤. ì£¼ë‹˜ì´ ëŠê»´ì§ˆ ê²ƒì…ë‹ˆë‹¤." },
            { verse: "ì„œë¡œ ì‚¬ë‘í•˜ë¼ ë‚´ê°€ ë„ˆí¬ë¥¼ ì‚¬ë‘í•œ ê²ƒ ê°™ì´ ë„ˆí¬ë„ ì„œë¡œ ì‚¬ë‘í•˜ë¼", ref: "ìš”í•œë³µìŒ 13:34", interp: "ì‚¬ë‘ì€ ê°€ì¥ ìœ„ëŒ€í•œ ê³„ëª…ì…ë‹ˆë‹¤. ì˜¤ëŠ˜ ë§Œë‚˜ëŠ” ì‚¬ëŒë“¤ì—ê²Œ ë”°ëœ»í•œ ë§ í•œë§ˆë””ë¥¼ ê±´ë„¤ë³´ì„¸ìš”." },
            { verse: "ë‚˜ì˜ í•˜ë‚˜ë‹˜ì´... ë„ˆí¬ ëª¨ë“  ì“¸ ê²ƒì„ ì±„ìš°ì‹œë¦¬ë¼", ref: "ë¹Œë¦½ë³´ì„œ 4:19", interp: "ë¶€ì¡±í•¨ ë•Œë¬¸ì— ì—¼ë ¤í•˜ì§€ ë§ˆì‹­ì‹œì˜¤. í•˜ëŠ˜ ì°½ê³ ë¥¼ ì—¬ì‹œëŠ” ì£¼ë‹˜ì´ ë‹¹ì‹ ì˜ í•„ìš”ë¥¼ ì•„ì‹­ë‹ˆë‹¤." },
            { verse: "ì§„ë¦¬ë¥¼ ì•Œì§€ë‹ˆ ì§„ë¦¬ê°€ ë„ˆí¬ë¥¼ ììœ ë¡­ê²Œ í•˜ë¦¬ë¼", ref: "ìš”í•œë³µìŒ 8:32", interp: "ë‹¹ì‹ ì„ ì–µëˆ„ë¥´ëŠ” ëª¨ë“  ìƒê°ì—ì„œ ììœ í•´ì§€ì‹­ì‹œì˜¤. ì£¼ë‹˜ì˜ ì§„ë¦¬ê°€ ë‹¹ì‹ ì„ ììœ ì¼€ í•©ë‹ˆë‹¤." },
            { verse: "ë²”ì‚¬ì— ê°ì‚¬í•˜ë©° ê¸°ë„í•˜ì‹­ì‹œì˜¤", ref: "ë¹Œë¦½ë³´ì„œ 4:6", interp: "ê¸°ë„ëŠ” í•˜ëŠ˜ì˜ ë¬¸ì„ ì—¬ëŠ” ì—´ì‡ ì…ë‹ˆë‹¤. ëª¨ë“  ì¼ì„ ê¸°ë„ë¡œ ì‹œì‘í•˜ê³  ê¸°ë„ë¡œ ë§ˆë¬´ë¦¬í•˜ì‹­ì‹œì˜¤." },
            { verse: "ë³´ë¼ ë‚´ê°€ ìƒˆ ì¼ì„ í–‰í•˜ë¦¬ë‹ˆ ì´ì œ ë‚˜íƒ€ë‚¼ ê²ƒì´ë¼", ref: "ì´ì‚¬ì•¼ 43:19", interp: "ê³¼ê±°ì— ë§¤ì—¬ ìˆì§€ ë§ˆì‹­ì‹œì˜¤. ì£¼ë‹˜ì´ ë‹¹ì‹ ì˜ ì‚¶ì— í–‰í•˜ì‹¤ ìƒˆë¡œìš´ ì¼ì„ ê¸°ëŒ€í•˜ì‹­ì‹œì˜¤." }
        ];

        let alarmSettings = JSON.parse(localStorage.getItem('holy_moment_alarms') || '[7, 8, 9, 12, 18, 20, 21, 22]');
        let lastNotifiedHour = -1;

        function updateVerse() {
            const now = new Date();
            const hour = now.getHours();
            const data = bibleData[hour % 24];

            document.getElementById('dateDisplay').textContent = now.toLocaleDateString('ko-KR', {
                year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit'
            });

            document.getElementById('verseText').textContent = data.verse;
            document.getElementById('verseRef').textContent = data.ref;
            document.getElementById('interpretationText').textContent = data.interp;

            loadCurrentReflection(hour);
            checkNotification(now);
        }

        // ì•ŒëŒ ì²´í¬ ë¡œì§
        function checkNotification(now) {
            const hour = now.getHours();
            if (alarmSettings.includes(hour) && lastNotifiedHour !== hour) {
                if (Notification.permission === "granted") {
                    const data = bibleData[hour % 24];
                    new Notification("âœ¨ Holy Moment: ì˜¤ëŠ˜ì˜ ë§ì”€", {
                        body: `"${data.verse}" \nì§€ê¸ˆ ì•±ì—ì„œ ë¬µìƒì„ ì‹œì‘í•´ ë³´ì„¸ìš”.`,
                        icon: 'https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?w=128&h=128&fit=crop'
                    });
                    lastNotifiedHour = hour;
                }
            }
        }

        function loadCurrentReflection(hour) {
            const dateStr = new Date().toDateString();
            const key = `reflection_${dateStr}_${hour}`;
            const saved = localStorage.getItem(key);
            document.getElementById('reflectionInput').value = saved || "";
        }

        // --- ê³ ë„í™” ê¸°ëŠ¥: TTS (ë§ì”€ ì½ê¸°) ---
        let synth = window.speechSynthesis;
        document.getElementById('ttsBtn').onclick = () => {
            if (synth.speaking) {
                synth.cancel();
                return;
            }
            const utter = new SpeechSynthesisUtterance(
                `${document.getElementById('verseText').textContent}. ${document.getElementById('verseRef').textContent}. ë¬µìƒ ê°€ì´ë“œì…ë‹ˆë‹¤. ${document.getElementById('interpretationText').textContent}`
            );
            utter.lang = 'ko-KR';
            utter.rate = 0.9;
            synth.speak(utter);
        };

        // --- ê³µìœ  ë° ë³µì‚¬ ê¸°ëŠ¥ ---
        function getShareMessage() {
            return `[Holy Moment ì˜¤ëŠ˜ì˜ ë§ì”€]\n\n"${document.getElementById('verseText').textContent}"\n- ${document.getElementById('verseRef').textContent}\n\nì˜¤ëŠ˜ì˜ ë¬µìƒ: ${document.getElementById('interpretationText').textContent}`;
        }

        document.getElementById('copyBtn').onclick = () => {
            navigator.clipboard.writeText(getShareMessage()).then(() => alert("ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! âœ¨"));
        };

        document.getElementById('shareBtn').onclick = () => {
            if (navigator.share) {
                navigator.share({ title: 'Holy Moment', text: getShareMessage(), url: window.location.href });
            } else { alert("ë³µì‚¬ ê¸°ëŠ¥ì„ ì´ìš©í•´ ì£¼ì„¸ìš”! ğŸ˜Š"); }
        };

        // --- ì•ŒëŒ ì„¤ì • UI ê´€ë ¨ ---
        const settingsModal = document.getElementById('settingsModal');
        const alarmGrid = document.getElementById('alarmGrid');

        function initAlarmUI() {
            alarmGrid.innerHTML = '';
            for (let i = 0; i < 24; i++) {
                const chip = document.createElement('div');
                chip.className = `hour-chip ${alarmSettings.includes(i) ? 'active' : ''}`;
                chip.textContent = `${i}ì‹œ`;
                chip.onclick = () => {
                    if (alarmSettings.includes(i)) {
                        alarmSettings = alarmSettings.filter(h => h !== i);
                        chip.classList.remove('active');
                    } else {
                        alarmSettings.push(i);
                        chip.classList.add('active');
                    }
                };
                alarmGrid.appendChild(chip);
            }
        }

        function toggleAllAlarms(select) {
            if (select) {
                alarmSettings = Array.from({ length: 24 }, (_, i) => i);
            } else {
                alarmSettings = [];
            }
            initAlarmUI();
        }

        document.getElementById('openSettings').onclick = () => {
            initAlarmUI();
            settingsModal.style.display = 'flex';
        };

        document.getElementById('saveSettings').onclick = () => {
            localStorage.setItem('holy_moment_alarms', JSON.stringify(alarmSettings));
            if (alarmSettings.length > 0 && Notification.permission !== "granted") {
                Notification.requestPermission().then(permission => {
                    if (permission === "granted") alert("ì•ŒëŒ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìœ¼ë©°, ì•Œë¦¼ ê¶Œí•œì´ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤. ğŸ™");
                });
            } else {
                alert("ì•ŒëŒ ì„¤ì •ì´ ì•ˆì „í•˜ê²Œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. âœ¨");
            }
            settingsModal.style.display = 'none';
        };

        // --- ê¸°íƒ€ ëª¨ë‹¬ ê´€ë ¨ ---
        const historyModal = document.getElementById('historyModal');
        document.getElementById('showHistory').onclick = () => {
            const history = JSON.parse(localStorage.getItem("holy_moment_history") || "[]");
            const list = document.getElementById('historyList');
            list.innerHTML = history.length ? "" : "<p style='text-align: center; color: #888;'>ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
            history.forEach(item => {
                const div = document.createElement('div');
                div.style = "border-bottom: 1px solid #eee; margin-bottom: 15px; padding-bottom: 10px;";
                div.innerHTML = `<p style="font-size: 0.8rem; color: #888;">${item.date}</p><p style="font-weight: 700;">${item.verse}</p><p>${item.content}</p>`;
                list.appendChild(div);
            });
            historyModal.style.display = 'flex';
        };

        document.getElementById('closeSettings').onclick = () => settingsModal.style.display = 'none';
        document.getElementById('closeHistory').onclick = () => historyModal.style.display = 'none';
        window.onclick = (e) => {
            if (e.target == settingsModal) settingsModal.style.display = 'none';
            if (e.target == historyModal) historyModal.style.display = 'none';
        };

        document.getElementById('saveBtn').onclick = function () {
            const text = document.getElementById('reflectionInput').value;
            if (!text.trim()) return alert("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”. âœ¨");
            const now = new Date();
            const hour = now.getHours();
            const dateStr = now.toDateString();
            const key = `reflection_${dateStr}_${hour}`;
            localStorage.setItem(key, text);

            let history = JSON.parse(localStorage.getItem("holy_moment_history") || "[]");
            history.unshift({ date: now.toLocaleString(), verse: document.getElementById('verseText').textContent, content: text });
            if (history.length > 50) history.pop();
            localStorage.setItem("holy_moment_history", JSON.stringify(history));
            alert("ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. ğŸ™");
        };

        updateVerse();
        setInterval(updateVerse, 30000); // 30ì´ˆë§ˆë‹¤ ì²´í¬

        // PWA ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('Service Worker registered!'))
                    .catch(err => console.log('SW registration failed:', err));
            });
        }
    </script>
</body>

</html>
